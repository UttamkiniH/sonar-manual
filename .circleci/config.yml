version: 2.1

orbs:
  sonarqube: syneki/sonarqube@1.0.1

jobs:
  android:
    working_directory: ~/sonarqube101
    docker:
      - image: reactnativecommunity/react-native-android
    steps:
      - checkout
      - run: npx envinfo
      - run: yarn install

      - run: cd android && chmod +x gradlew && ./gradlew --no-daemon bundleRelease assembleRelease
      - run: cd android/app/build/outputs/apk/release && ls && pwd
      - store_artifacts:
          path: android/app/build/outputs/bundle/release
          destination: release-aab/
      - store_artifacts:
          path: android/app/build/outputs/apk/release
          destination: release-apk/
      - sonarqube/scan:
          project-key: GeekyAnts_Sonarqube-sample_AYZfZG4bmIpfUe2r3Gqa
          organization: geekyants
          token: $SONARQUBE_TOKEN

workflows:
  version: 2
  build_and_test:
    jobs:
      - android
      

env:
  SONARQUBE_TOKEN: sqp_3c913723a97471cb73887e35beb8d07ce6ef7017
