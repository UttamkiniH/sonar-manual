
version: '2.1'
orbs:
  sonarqube: ft-circleci-orbs/sonarqube-orb@1.0.0
  

jobs:

  sonar:
    working_directory: ~/sonarqube101
    docker:
      - image: reactnativecommunity/react-native-android
    steps:
      - checkout
      - attach_workspace:
          at: ~/sonarqube101

      - sonarcloud/scan:
          sonar_token_variable_name: $SONARQUBE_TOKEN

  android:
    working_directory: ~/sonarqube101
    docker:
      - image: reactnativecommunity/react-native-android
    steps:
      - checkout
      - run: npx envinfo
      - run: yarn install

      - run: cd android && chmod +x gradlew && ./gradlew --no-daemon bundleRelease assembleRelease
      - run: cd android/app/build/outputs/apk/release && ls && pwd
      - store_artifacts:
          path: android/app/build/outputs/bundle/release
          destination: release-aab/
      - store_artifacts:
          path: android/app/build/outputs/apk/release
          destination: release-apk/
          
workflows:
  your-workflow:
    jobs:
      - android
      - sonarqube/scan